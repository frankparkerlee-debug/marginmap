# ðŸš€ MarginMap Deployment Guide for Render.com

## Quick Start - Deploy Now

### Option 1: One-Click Deploy (Recommended)
1. Click this button: [![Deploy to Render](https://render.com/images/deploy-to-render-button.svg)](https://render.com/deploy?repo=https://github.com/frankparkerlee-debug/marginmap)
2. Sign in to Render (or create free account)
3. Click "Create Web Service"
4. Wait 3-5 minutes for build to complete
5. Visit your live URL!

### Option 2: Manual Setup (Step-by-Step)

#### Step 1: Create Account
- Go to [render.com](https://render.com)
- Sign up with GitHub (easiest)
- Verify your email

#### Step 2: Connect GitHub Repository
1. In Render Dashboard, click **"New +"** â†’ **"Web Service"**
2. Click **"Connect a repository"**
3. Authorize Render to access GitHub
4. Select: `frankparkerlee-debug/marginmap`
5. Click **"Connect"**

#### Step 3: Configure Service

Render should auto-detect `render.yaml`, but verify these settings:

**Basic Settings:**
- **Name:** `marginmap` (or your preferred name)
- **Region:** Oregon (or closest to you)
- **Branch:** `main`
- **Runtime:** Node
- **Build Command:** `npm ci && npm run migrate && npm run seed`
- **Start Command:** `npm start`

**Environment Variables:**
Render will auto-populate from `render.yaml`, but verify:
```
NODE_ENV=production
PORT=3000
SESSION_SECRET=<auto-generated-by-render>
DATABASE_PATH=./data/marginmap.db
UPLOAD_DIR=./storage/uploads
TARGET_MARGIN_PERCENT=55
NODE_VERSION=20.18.0
```

**Plan:**
- Select **"Free"** tier (perfect for demo/testing)

#### Step 4: Deploy!
1. Click **"Create Web Service"**
2. Watch the build logs in real-time
3. Build should complete in 3-5 minutes

#### Step 5: Verify Deployment

You'll see these logs:
```
==> Cloning from https://github.com/frankparkerlee-debug/marginmap...
==> Using Node version 20.18.0
==> Running npm ci
==> Installing dependencies...
==> Running npm run migrate
ðŸ”„ Running database migrations...
âœ“ Database migrations completed successfully
==> Running npm run seed
ðŸŒ± Seeding database...
âœ“ Created demo user: analyst@marginmap.io
==> Starting npm start
âœ“ Database initialized
ðŸŒ± No users found, seeding database...
âœ“ Created demo user: analyst@marginmap.io
ðŸš€ MarginMap is running!
âœ“ Ready to analyze profitability
==> Your service is live!
```

#### Step 6: Test Your App

Your app will be live at: `https://marginmap.onrender.com` (or your custom name)

Test these URLs:
1. **Landing Page:** `https://marginmap.onrender.com/`
2. **Health Check:** `https://marginmap.onrender.com/health`
3. **Login:** `https://marginmap.onrender.com/login.html`

**Demo Credentials:**
- Email: `analyst@marginmap.io`
- Password: `demo123`

---

## Troubleshooting

### Problem: Build Fails with "better-sqlite3" Error
**Solution:** Ensure Node version is 20.x (set in `.node-version`, `.nvmrc`, and `render.yaml`)

### Problem: "Invalid Credentials" on Login
**Solution:** Database wasn't seeded. Redeploy or check logs for seed errors.

### Problem: Logs in then Immediately Logs Out
**Solution:** Session cookies issue. Verify `trust proxy` is enabled (fixed in latest commit).

### Problem: "Application Error" or 500 Error
**Solution:**
1. Check Render logs for specific error
2. Verify all environment variables are set
3. Ensure `NODE_ENV=production` is set

### Problem: Auto-Deploy Not Working
**Solution:**
1. Go to Render Dashboard â†’ Your Service
2. Click **"Settings"** â†’ **"Build & Deploy"**
3. Enable **"Auto-Deploy"** (should be ON by default)
4. Verify branch is set to `main`

---

## Manual Redeploy

If auto-deploy isn't working:

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click on your **marginmap** service
3. Click **"Manual Deploy"** â†’ **"Deploy latest commit"**
4. Wait for build to complete

---

## Enable Auto-Deploy

To enable automatic deployments on git push:

1. In Render Dashboard â†’ Your Service
2. Go to **"Settings"**
3. Scroll to **"Build & Deploy"**
4. Toggle **"Auto-Deploy"** to **YES**
5. Now every `git push` will trigger deployment!

---

## Custom Domain (Optional)

To use your own domain:

1. In Render â†’ Your Service â†’ **"Settings"**
2. Scroll to **"Custom Domains"**
3. Click **"Add Custom Domain"**
4. Follow instructions to update DNS records
5. Render provides free SSL certificates!

---

## Monitoring & Logs

### View Live Logs
1. Go to your service in Render Dashboard
2. Click **"Logs"** tab
3. See real-time server output

### Check Metrics
1. Click **"Metrics"** tab
2. View CPU, Memory, Response times
3. Monitor request volume

---

## Current Deployment Status

âœ… **Latest Commit:** `a5d07ec` - Session persistence fix
âœ… **GitHub:** All changes pushed to `main` branch
âœ… **Ready:** All code is production-ready

**Next Step:** Create the Render web service using the steps above!

---

## Support

If deployment fails:
1. Check Render build logs for specific errors
2. Verify GitHub repository is accessible
3. Ensure all commits are pushed: `git push origin main`
4. Check environment variables are set correctly

**Repository:** [github.com/frankparkerlee-debug/marginmap](https://github.com/frankparkerlee-debug/marginmap)

**Issues:** Create an issue in the GitHub repo with build logs

---

**Last Updated:** 2025-11-04
**Version:** 1.0.0
**Status:** Production Ready âœ…
